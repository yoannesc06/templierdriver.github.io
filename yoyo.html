<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        height: 100vh;
        width: 100vw;
        background-color: black;
        margin: 0rem;
        overflow: hidden;
      }

      #image-track {
        display: flex;
        gap: 4vmin;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(0%, -50%);
        user-select: none;
      }

      #image-track > .image {
        width: 40vmin;
        height: 56vmin;
        object-fit: cover;
        object-position: 100% center;
      }

      /* Indicateur de progression */
      .progress-indicator {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        color: white;
        font-family: "Arial", sans-serif;
        font-size: 16px;
        font-weight: 500;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        padding: 8px 16px;
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        z-index: 1000;
      }

      .progress-number {
        display: inline-block;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .progress-number.animate {
        transform: translateY(-20px);
        opacity: 0;
      }

      .progress-total {
        opacity: 0.7;
      }

      /* Animation keyframes pour le changement de nombre */
      @keyframes slideUp {
        0% {
          transform: translateY(20px);
          opacity: 0;
        }
        100% {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .progress-number.slide-in {
        animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      /* Animation de fade out après quelques secondes */
      .scroll-instruction.fade-out {
        opacity: 0;
        transition: opacity 1s ease-out;
      }

      /* Modal lightbox */
      .lightbox {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.95);
        backdrop-filter: blur(20px);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .lightbox.active {
        opacity: 1;
        visibility: visible;
      }

      .lightbox-content {
        position: relative;
        max-width: 90vw;
        max-height: 90vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .lightbox-image {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        transform: scale(0.8);
        transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .lightbox.active .lightbox-image {
        transform: scale(1);
      }

      /* Bouton fermer */
      .close-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        color: white;
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
      }

      .close-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.1);
      }

      /* Miniatures en bas au centre */
      .thumbnails-container {
        position: absolute;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        max-width: 600px;
        justify-content: center;
      }

      .thumbnail {
        width: 60px;
        height: 80px;
        object-fit: cover;
        border-radius: 6px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        opacity: 0.7;
      }

      .thumbnail:hover {
        transform: scale(1.1);
        opacity: 1;
      }

      .thumbnail.active {
        border-color: white;
        opacity: 1;
        transform: scale(1.05);
      }

      /* Animation de changement d'image */
      .lightbox-image.changing {
        transform: scale(0.95);
        opacity: 0;
      }

      .lightbox-image.slide-in {
        animation: slideInImage 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      }

      @keyframes slideInImage {
        0% {
          transform: scale(0.9) translateX(50px);
          opacity: 0;
        }
        100% {
          transform: scale(1) translateX(0);
          opacity: 1;
        }
      }

      /* Animation pour l'indicateur de progression dans le lightbox */
      .lightbox-progress-number.animate {
        transform: translateY(-15px);
        opacity: 0;
      }

      .lightbox-progress-number.slide-in {
        animation: slideUpNumber 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Indicateur de progression dans le lightbox */
      .lightbox-progress {
        position: absolute;
        bottom: 120px;
        left: 50%;
        transform: translateX(-50%);
        color: white;
        font-family: "Arial", sans-serif;
        font-size: 16px;
        font-weight: 500;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        padding: 8px 16px;
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .lightbox-progress-number {
        display: inline-block;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .lightbox-progress-total {
        opacity: 0.7;
      }
      #image-track > .image {
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      #image-track > .image:hover {
        transform: scale(1.05);
      }
    </style>
  </head>
  <body>
    <div id="image-track" data-mouse-down-at="0" data-prev-percentage="0">
      <img
        class="image"
        src="https://images.unsplash.com/photo-1524781289445-ddf8f5695861?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1770&q=80"
        draggable="false"
      />
      <img
        class="image"
        src="https://images.unsplash.com/photo-1610194352361-4c81a6a8967e?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1674&q=80"
        draggable="false"
      />
      <img
        class="image"
        src="https://images.unsplash.com/photo-1618202133208-2907bebba9e1?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1770&q=80"
        draggable="false"
      />
      <img
        class="image"
        src="https://images.unsplash.com/photo-1495805442109-bf1cf975750b?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1770&q=80"
        draggable="false"
      />
      <img
        class="image"
        src="https://images.unsplash.com/photo-1548021682-1720ed403a5b?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1770&q=80"
        draggable="false"
      />
      <img
        class="image"
        src="https://images.unsplash.com/photo-1496753480864-3e588e0269b3?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2134&q=80"
        draggable="false"
      />
      <img
        class="image"
        src="https://images.unsplash.com/photo-1613346945084-35cccc812dd5?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1759&q=80"
        draggable="false"
      />
      <img
        class="image"
        src="https://images.unsplash.com/photo-1516681100942-77d8e7f9dd97?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1770&q=80"
        draggable="false"
      />
    </div>

    <!-- Lightbox modal -->
    <div class="lightbox" id="lightbox">
      <div class="lightbox-content">
        <img class="lightbox-image" id="lightbox-image" src="" alt="" />
        <button class="close-btn" id="close-btn">×</button>

        <!-- Indicateur de progression dans le lightbox -->
        <div class="lightbox-progress">
          <span class="lightbox-progress-number" id="lightbox-progress-number"
            >1</span
          >
          <span class="lightbox-progress-total">/8</span>
        </div>

        <!-- Miniatures -->
        <div class="thumbnails-container" id="thumbnails-container">
          <!-- Les miniatures seront générées dynamiquement -->
        </div>
      </div>
    </div>

    <!-- Indicateur de progression -->
    <div class="progress-indicator">
      <span class="progress-number" id="current-image">1</span>
      <span class="progress-total">/8</span>
    </div>

    <script>
      const track = document.getElementById("image-track");
      const currentImageSpan = document.getElementById("current-image");
      const totalImages = track.getElementsByClassName("image").length;
      const lightbox = document.getElementById("lightbox");
      const lightboxImage = document.getElementById("lightbox-image");
      const closeBtn = document.getElementById("close-btn");
      const thumbnailsContainer = document.getElementById(
        "thumbnails-container"
      );
      const lightboxProgressNumber = document.getElementById(
        "lightbox-progress-number"
      );

      let currentImageIndex = 1;
      let currentLightboxIndex = 0;
      const imageUrls = Array.from(track.getElementsByClassName("image")).map(
        (img) => img.src
      );

      // Générer les miniatures
      const generateThumbnails = () => {
        thumbnailsContainer.innerHTML = "";
        imageUrls.forEach((url, index) => {
          const thumbnail = document.createElement("img");
          thumbnail.src = url;
          thumbnail.className = "thumbnail";
          thumbnail.addEventListener("click", () => changeLightboxImage(index));
          thumbnailsContainer.appendChild(thumbnail);
        });
      };

      // Ouvrir le lightbox
      const openLightbox = (index) => {
        currentLightboxIndex = index;
        lightboxImage.src = imageUrls[index];
        lightbox.classList.add("active");
        document.body.style.overflow = "hidden";
        updateThumbnailActive();
        updateLightboxProgress();
      };

      // Fermer le lightbox
      const closeLightbox = () => {
        lightbox.classList.remove("active");
        document.body.style.overflow = "hidden";
      };

      // Changer l'image du lightbox avec animation
      const changeLightboxImage = (index) => {
        if (index === currentLightboxIndex) return;

        // Animation de sortie
        lightboxImage.classList.add("changing");
        lightboxProgressNumber.classList.add("animate");

        setTimeout(() => {
          currentLightboxIndex = index;
          lightboxImage.src = imageUrls[index];

          // Animation d'entrée
          lightboxImage.classList.remove("changing");
          lightboxImage.classList.add("slide-in");

          updateThumbnailActive();
          updateLightboxProgress();

          // Animation du numéro
          lightboxProgressNumber.classList.remove("animate");
          lightboxProgressNumber.classList.add("slide-in");

          // Nettoyer les classes d'animation
          setTimeout(() => {
            lightboxImage.classList.remove("slide-in");
            lightboxProgressNumber.classList.remove("slide-in");
          }, 600);
        }, 300);
      };

      // Mettre à jour l'indicateur de progression du lightbox
      const updateLightboxProgress = () => {
        lightboxProgressNumber.textContent = currentLightboxIndex + 1;
      };

      // Mettre à jour la miniature active
      const updateThumbnailActive = () => {
        const thumbnails = thumbnailsContainer.querySelectorAll(".thumbnail");
        thumbnails.forEach((thumb, index) => {
          thumb.classList.toggle("active", index === currentLightboxIndex);
        });
      };

      // Événements lightbox
      closeBtn.addEventListener("click", closeLightbox);
      lightbox.addEventListener("click", (e) => {
        if (e.target === lightbox) closeLightbox();
      });

      // Ajouter les événements de clic aux images principales
      Array.from(track.getElementsByClassName("image")).forEach(
        (img, index) => {
          img.addEventListener("click", () => openLightbox(index));
        }
      );

      // Fermer avec Escape
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && lightbox.classList.contains("active")) {
          closeLightbox();
        }
      });

      // Initialiser les miniatures
      generateThumbnails();

      const updateProgressIndicator = (percentage) => {
        // Calculer l'index de l'image actuelle basé sur le pourcentage
        const newIndex =
          Math.round((Math.abs(percentage) / 100) * (totalImages - 1)) + 1;

        if (newIndex !== currentImageIndex) {
          // Animation de sortie
          currentImageSpan.classList.add("animate");

          setTimeout(() => {
            currentImageIndex = newIndex;
            currentImageSpan.textContent = currentImageIndex;
            currentImageSpan.classList.remove("animate");
            currentImageSpan.classList.add("slide-in");

            setTimeout(() => {
              currentImageSpan.classList.remove("slide-in");
            }, 300);
          }, 150);
        }
      };

      const animateTrack = (nextPercentage) => {
        track.dataset.percentage = nextPercentage;

        track.animate(
          {
            transform: `translate(${nextPercentage}%, -50%)`,
          },
          { duration: 1200, fill: "forwards" }
        );

        for (const image of track.getElementsByClassName("image")) {
          image.animate(
            {
              objectPosition: `${100 + nextPercentage}% center`,
            },
            { duration: 1200, fill: "forwards" }
          );
        }

        updateProgressIndicator(nextPercentage);
      };

      const handleOnDown = (e) => (track.dataset.mouseDownAt = e.clientX);

      const handleOnUp = () => {
        track.dataset.mouseDownAt = "0";
        track.dataset.prevPercentage = track.dataset.percentage;
      };

      const handleOnMove = (e) => {
        if (track.dataset.mouseDownAt === "0") return;

        const mouseDelta = parseFloat(track.dataset.mouseDownAt) - e.clientX,
          maxDelta = window.innerWidth / 2;

        const percentage = (mouseDelta / maxDelta) * -100,
          nextPercentageUnconstrained =
            parseFloat(track.dataset.prevPercentage) + percentage,
          nextPercentage = Math.max(
            Math.min(nextPercentageUnconstrained, 0),
            -100
          );

        animateTrack(nextPercentage);
      };

      // Gestion du scroll avec la molette (horizontal)
      const handleWheel = (e) => {
        e.preventDefault();

        const currentPercentage = parseFloat(track.dataset.prevPercentage) || 0;
        const scrollSensitivity = 0.8; // Scroll encore plus lent et précis

        // Détecter le scroll horizontal et vertical
        let scrollDelta = 0;

        // Si c'est un scroll horizontal (shift + molette ou trackpad)
        if (e.deltaX !== 0) {
          scrollDelta = e.deltaX > 0 ? -scrollSensitivity : scrollSensitivity;
        }
        // Si c'est un scroll vertical, on l'inverse pour faire du horizontal
        else if (e.deltaY !== 0) {
          scrollDelta = e.deltaY > 0 ? -scrollSensitivity : scrollSensitivity;
        }

        const nextPercentageUnconstrained = currentPercentage + scrollDelta;
        const nextPercentage = Math.max(
          Math.min(nextPercentageUnconstrained, 0),
          -100
        );

        track.dataset.prevPercentage = nextPercentage;
        animateTrack(nextPercentage);
      };

      // Événements souris
      window.onmousedown = (e) => handleOnDown(e);
      window.onmouseup = (e) => handleOnUp(e);
      window.onmousemove = (e) => handleOnMove(e);

      // Événements tactiles
      window.ontouchstart = (e) => handleOnDown(e.touches[0]);
      window.ontouchend = (e) => handleOnUp(e.touches[0]);
      window.ontouchmove = (e) => handleOnMove(e.touches[0]);

      // Événement de scroll
      window.addEventListener("wheel", handleWheel, { passive: false });

      // Initialiser l'indicateur
      updateProgressIndicator(0);
    </script>
  </body>
</html>
